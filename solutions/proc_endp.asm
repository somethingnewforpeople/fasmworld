include "PROC16.INC" 					; –≤–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
;-----------------------------------
use16 									; –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 16-–±–∏—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è DOS
org 100h 								; –Ω–∞—á–∞–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –∞–¥—Ä–µ—Å–∞ 100h


start: 									; –º–µ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
	stdcall fib, 10 					; –≤—ã–∑–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã fib —Å –ø–µ—Ä–µ–¥–∞—á–µ–π 2


exit: 									; –º–µ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
	mov ax, 4C00h 						; –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
	int 21h 							; –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ DOS


;-----------------------------------
; –ê—Å—Å–µ–º–±–ª–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —á–∏—Å–µ–ª —Ñ–∏–±–æ–Ω–∞—á—á–∏
;-----------------------------------
proc fib stdcall uses cx, my_var		; –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º cx –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º my_var
local local_var dd ? 					; –ª–æ–∫–∞–ª—å–Ω–∞—è –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è local_var
	mov cx, word[my_var] 				; cx = –∫–æ–ª-–≤–æ —á–∏—Å–µ–ª —Ñ–∏–±–æ–Ω–∞—á—á–∏
	jcxz .xor_ax 						; –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –º–µ—Ç–∫—É xor_ax –µ—Å–ª–∏ cx = 0
	dec cx 								; –¥–∏–∫—Ä–µ–º–µ–Ω—Ç cx(cx-1)
	jz @f 								; –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∞–Ω–æ–Ω. –º–µ—Ç–∫—É –µ—Å–ª–∏ 'z' = 1
	stdcall fib, cx 					; –≤—ã–∑–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å –ø–µ—Ä–µ–¥–∞—á–µ–π cx
	mov word[local_var], ax 			; –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ax –≤ —Å–ª–æ–≤–æ local_var
	mov word[local_var+2], dx 			; –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ dx –≤ —Å–ª–æ–≤–æ+2 local_var
	dec cx 								; –¥–∏–∫—Ä–µ–º–µ–Ω—Ç cx(cx-1)
	stdcall fib, cx 					; –≤—ã–∑–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å –ø–µ—Ä–µ–¥–∞—á–µ–π cx
	add ax, word[local_var] 			; —Å–ª–æ–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞ local_var –∏ ax
	adc dx, word[local_var+2] 			; —Å–ª–æ–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞+2 local_var –∏ ax —Å —Ñ–ª–∞–≥–æ–º 'c'
	jmp .end_proc 						; –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –º–µ—Ç–∫—É end_proc
@@: 									; –º–µ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ax = 1
	mov ax, 1 							; ax = 1
	jmp @f 								; –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∞–Ω–æ–Ω. –º–µ—Ç–∫—É
.xor_ax: 								; –ª–æ–∫–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞ –æ–±–Ω—É–ª–µ–Ω–∏—è ax
	xor ax, ax 							; ax = 0
@@: 									; –º–µ—Ç–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–ª—è —Å–ª–æ–≤–∞ –≤ –¥–≤–æ–π–Ω–æ–µ —Å–ª–æ–≤–æ
	cwd 								; –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ax=–º–ª–∞–¥—à–∞—è —á–∞—Å—Ç—å, dx=—Å—Ç–∞—Ä—à–∞—è —á–∞—Å—Ç—å
.end_proc: 								; –ª–æ–∫–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞ end_proc –¥–ª—è –∫–æ–Ω—Ü–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
	ret									; –≤—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
endp 									; –∫–æ–Ω–µ—Ü –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
;-----------------------------------
; –í —ç—Ç–æ—Ç —Ä–∞–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏–∑–∞—Å—Å–µ–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ üôÇ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—É - (https://fasmworld.ru/content/course/029/shot06.png) –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –¥–ª—è –Ω–µ—ë –∞—Å—Å–µ–º–±–ª–µ—Ä–Ω—ã–π –∫–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞–∫—Ä–æ—Å–æ–≤ PROC16. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞? –ü–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ —É –Ω–µ—ë –µ—Å—Ç—å –∏ –∫–∞–∫ –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.
